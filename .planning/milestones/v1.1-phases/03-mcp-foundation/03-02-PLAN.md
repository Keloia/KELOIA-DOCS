---
phase: 03-mcp-foundation
plan: 02
type: execute
wave: 2
depends_on:
  - 03-01
files_modified:
  - .mcp.json
autonomous: false
requirements:
  - MCP-04

must_haves:
  truths:
    - "Claude Code shows keloia server as 'connected' in /mcp status"
    - ".mcp.json at repo root registers the server for project-scope access"
  artifacts:
    - path: ".mcp.json"
      provides: "Claude Code project-scope MCP registration"
      contains: "mcpServers"
  key_links:
    - from: ".mcp.json"
      to: "mcp-server/dist/index.js"
      via: "command + args spawning"
      pattern: "mcp-server/dist/index.js"
---

<objective>
Register the MCP server with Claude Code via `.mcp.json` and verify the full connection works end-to-end.

Purpose: Complete the foundation by proving Claude Code can spawn and connect to the server. This is the final proof that the toolchain, module system, path resolution, and logging discipline are all correct.

Output: `.mcp.json` at repo root; server visible in Claude Code's `/mcp` status.
</objective>

<execution_context>
@/Users/enjat/.claude/get-shit-done/workflows/execute-plan.md
@/Users/enjat/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-mcp-foundation/03-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create .mcp.json and verify build</name>
  <files>
    .mcp.json
  </files>
  <action>
Create `.mcp.json` at the repo root (not inside mcp-server/) for Claude Code project-scope registration:

```json
{
  "mcpServers": {
    "keloia": {
      "command": "node",
      "args": ["mcp-server/dist/index.js"],
      "env": {}
    }
  }
}
```

Before creating the file, verify the build artifact exists:
1. Run `ls mcp-server/dist/index.js` — must exist (built by Plan 01)
2. If dist/index.js doesn't exist, run `cd mcp-server && npm run build` first

Key constraints:
- `command` is `"node"` (system executable, always in PATH)
- `args` path is relative to repo root (Claude Code spawns from project root)
- Do NOT use `npx tsx` — built output is more reliable for Claude Code's process spawning
- Do NOT put .mcp.json inside mcp-server/ — it must be at repo root for project-scope detection
  </action>
  <verify>
1. `cat .mcp.json | python3 -m json.tool` — valid JSON
2. `node mcp-server/dist/index.js 2>&1 1>/dev/null | head -4` — shows [keloia-mcp] path lines
3. All four paths in stderr output are correct absolute paths pointing to existing directories
  </verify>
  <done>
.mcp.json exists at repo root with correct command/args format. Server can be spawned from repo root via `node mcp-server/dist/index.js` and logs correct paths to stderr.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Verify Claude Code connection</name>
  <files>.mcp.json</files>
  <action>
CHECKPOINT — no automated work. User verifies Claude Code connection.

What was built: MCP server skeleton registered with Claude Code via .mcp.json. The server should appear in Claude Code's MCP status with zero tools (tools are added in phases 4-5).
  </action>
  <verify>
1. Restart Claude Code (or run `/mcp` to refresh connections)
2. Run `/mcp` in Claude Code
3. Verify "keloia" appears in the server list
4. Verify status shows "connected" (not "failed" or "disconnected")
5. Zero tools is expected and correct at this stage

If the server shows "failed to start":
- Check stderr output for errors (path resolution issues, missing modules)
- Verify `node mcp-server/dist/index.js` runs without error from the repo root
- Verify node_modules exists in mcp-server/ (run `cd mcp-server && npm install` if not)
  </verify>
  <done>
User confirms keloia server shows as "connected" in Claude Code /mcp status. Type "approved" or describe the error.
  </done>
</task>

</tasks>

<verification>
1. `.mcp.json` exists at repo root with valid JSON
2. `"command": "node"` and `"args"` contains `"mcp-server/dist/index.js"`
3. Claude Code `/mcp` shows keloia as connected
</verification>

<success_criteria>
- .mcp.json at repo root registers keloia server for project-scope access
- Claude Code shows keloia as "connected" in /mcp status
- Server has zero tools (correct for Phase 3 — tools added in phases 4-5)
</success_criteria>

<output>
After completion, create `.planning/phases/03-mcp-foundation/03-02-SUMMARY.md`
</output>
