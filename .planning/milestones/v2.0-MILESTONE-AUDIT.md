---
milestone: v2.0
audited: 2026-02-22T14:30:00Z
status: tech_debt
scores:
  requirements: 23/23
  phases: 7/7
  integration: 17/18
  flows: 2/3
gaps:
  requirements: []
  integration:
    - id: "INT-NEW-01"
      severity: "low"
      description: "#/docs/new route missing auth guard at router level"
      affected_requirements: ["AUTH-04", "CRUD-01"]
      evidence: "app.js lines 789-791: renderCreateView() called without getAuthToken() check. Unauth users who enter #/docs/new directly see the create form. Write fails safely at github.js authHeaders() throw. The #new-doc-btn is .auth-only so hidden when unauth — only reachable via direct URL entry."
      fix: "Add if (!getAuthToken()) { window.location.hash = '#/docs'; return; } before renderCreateView() call"
  flows: []
tech_debt:
  - phase: 06-site-search-guide
    items:
      - "mcp-guide.md tool reference table lists 7 pre-Phase-7 tools only; 4 Phase 7 tools (keloia_search_docs, keloia_add_doc, keloia_edit_doc, keloia_delete_doc) missing from guide"
  - phase: 10-site-doc-crud
    items:
      - "10-02-SUMMARY.md missing requirements-completed frontmatter field (has provides: [CRUD-01, CRUD-04] but not requirements-completed)"
  - phase: 11-interactive-kanban
    items:
      - "Verification status is human_needed — drag-and-drop requires live browser testing"
---

# Milestone v2.0 Audit: Search + Auth + CRUD

**Audited:** 2026-02-22
**Status:** tech_debt — all requirements met, no critical blockers, minor accumulated debt
**Previous audit:** 2026-02-22T14:00:00Z (pre-Phase 12 — identified INT-01 through INT-04, all fixed)

---

## Requirements Coverage (23/23)

All 23 v2.0 requirements are satisfied across the 3-source cross-reference.

### 3-Source Cross-Reference

| REQ-ID | Description | VERIFICATION | SUMMARY Frontmatter | REQUIREMENTS.md | Final |
|--------|-------------|-------------|---------------------|-----------------|-------|
| SRCH-01 | Search box in sidebar | passed (Ph6) | 06-01 | [x] | **satisfied** |
| SRCH-02 | Live search (debounced) | passed (Ph6) | 06-02 | [x] | **satisfied** |
| SRCH-03 | Results show name + snippet | passed (Ph6) | 06-02 | [x] | **satisfied** |
| SRCH-04 | Click result navigates | passed (Ph6) | 06-02 | [x] | **satisfied** |
| SRCH-05 | MCP keloia_search_docs | passed (Ph7) | 07-01 | [x] | **satisfied** |
| SRCH-06 | MCP search slug filter | passed (Ph7) | 07-01 | [x] | **satisfied** |
| AUTH-01 | PAT entry to authenticate | passed (Ph8) | 08-01 | [x] | **satisfied** |
| AUTH-02 | Token persists in localStorage | passed (Ph8) | 08-01 | [x] | **satisfied** |
| AUTH-03 | Logout clears token | passed (Ph8) | 08-01 | [x] | **satisfied** |
| AUTH-04 | Write controls hidden when unauth | passed (Ph8) | 08-01 | [x] | **satisfied** |
| CRUD-01 | Create new doc | passed (Ph10) | 10-02 provides | [x] | **satisfied** |
| CRUD-02 | Edit existing doc | passed (Ph10) | 10-01 | [x] | **satisfied** |
| CRUD-03 | Preview toggle while editing | passed (Ph10) | 10-01 | [x] | **satisfied** |
| CRUD-04 | Delete doc with confirmation | passed (Ph10) | 10-02 provides | [x] | **satisfied** |
| CRUD-05 | All writes via GitHub API | passed (Ph9) | 09-01 | [x] | **satisfied** |
| CRUD-06 | MCP keloia_add_doc | passed (Ph7) | 07-01 | [x] | **satisfied** |
| CRUD-07 | MCP keloia_edit_doc | passed (Ph7) | 07-01 | [x] | **satisfied** |
| CRUD-08 | MCP keloia_delete_doc | passed (Ph7) | 07-01 | [x] | **satisfied** |
| KNBN-01 | Drag cards between columns | passed (Ph11) | 11-01 | [x] | **satisfied** |
| KNBN-02 | Confirmation modal before save | passed (Ph11) | 11-01 | [x] | **satisfied** |
| KNBN-03 | Column change persisted via API | passed (Ph11) | 11-01 | [x] | **satisfied** |
| GUID-01 | Guide accessible from navigation | passed (Ph6) | 06-01 | [x] | **satisfied** |
| GUID-02 | Guide has editor configs | passed (Ph6) | 06-01 | [x] | **satisfied** |

**Orphaned requirements:** 0
**Unsatisfied requirements:** 0

---

## Phase Verifications (7/7)

| Phase | Name | Status | Score |
|-------|------|--------|-------|
| 06 | Site Search + Guide | passed | 10/10 |
| 07 | MCP Search + Doc CRUD | passed | 10/10 |
| 08 | GitHub Auth | passed | 6/6 |
| 09 | GitHub API Wrapper | passed | 5/5 |
| 10 | Site Doc CRUD | passed | 4/4 |
| 11 | Interactive Kanban | passed (human_needed) | 5/5 |
| 12 | Cross-Phase Integration Fixes | passed | 6/6 |

All 7 phases passed verification. Phase 11 has human verification items for live drag-and-drop testing. Phase 12 resolved all integration gaps (INT-01 through INT-04, FLOW-01, FLOW-02) from the previous audit.

---

## Cross-Phase Integration (17/18 wiring points)

### Verified Connected (17)

All major cross-phase wiring points verified correct:

- Phase 8 `getAuthToken()` -> Phase 9 `github.js` `authHeaders()`
- Phase 9 `writeFile`/`deleteFile`/`getFile` -> Phase 10 doc CRUD views
- Phase 9 `writeFile`/`getFile` -> Phase 11 kanban move
- Phase 8 `body.authenticated` -> Phase 10 `.auth-only` controls
- Phase 8 `body.authenticated` -> Phase 11 kanban drag gating
- Phase 12 search invalidation -> Phase 10 all 3 CRUD success paths
- Phase 12 edit route auth guard -> Router `#/docs/slug/edit`
- Phase 12 script order fix -> `github.js` before `app.js` in `index.html`
- Phase 12 `mcp-guide` in `index.json` -> Phase 7 MCP tools can access it
- Phase 7 `registerDocTools` -> `server.ts`
- Phase 6 MiniSearch CDN -> Phase 6 search JS
- Phase 6 search DOM elements -> Phase 6 search listeners

### Finding: #/docs/new route missing auth guard (LOW)

`app.js` lines 789-791: `renderCreateView()` called without `getAuthToken()` check. An unauthenticated user who enters `#/docs/new` directly sees the create form. The write is safely blocked by `github.js` `authHeaders()` throwing "Not authenticated" when they submit. The `#new-doc-btn` is `.auth-only` so hidden when unauthenticated — only reachable via direct URL entry.

**Affected requirements:** AUTH-04, CRUD-01
**Fix:** Add `if (!getAuthToken()) { window.location.hash = '#/docs'; return; }` before `renderCreateView()` call

---

## E2E Flow Verification (2/3)

| Flow | Status | Notes |
|------|--------|-------|
| Edit doc while unauthenticated via direct URL | COMPLETE | Auth guard redirects to doc view |
| Create doc while unauthenticated via direct URL | PARTIAL | Form visible, write blocked at API level |
| MCP search finds mcp-guide content | COMPLETE | mcp-guide in index.json, search tool reads it |

All other major user flows (search, auth, CRUD, kanban) verified at the phase level.

---

## Previously Identified Gaps — Now Resolved

Phase 12 closed all gaps from the previous audit:

| Gap ID | Description | Fix Applied |
|--------|-------------|-------------|
| INT-01 | Search index not invalidated after CRUD | `searchIndex = null; buildSearchIndex()` in all 3 CRUD paths |
| INT-02 | Edit route accessible without auth | `getAuthToken()` guard with `return` in router |
| INT-03 | Script load order inverted | `github.js` before `app.js` in `index.html` |
| INT-04 | mcp-guide excluded from MCP tools | Added to `data/docs/index.json` |
| FLOW-01 | Create doc -> search fails | Resolved by INT-01 |
| FLOW-02 | Edit doc -> search fails | Resolved by INT-01 |

---

## Tech Debt Summary

### Phase 6: Site Search + Guide
- `data/docs/mcp-guide.md` tool reference table lists 7 pre-Phase-7 tools only; 4 Phase 7 tools (`keloia_search_docs`, `keloia_add_doc`, `keloia_edit_doc`, `keloia_delete_doc`) missing from guide

### Phase 10: Site Doc CRUD
- `10-02-SUMMARY.md` missing `requirements-completed` frontmatter field (has `provides: [CRUD-01, CRUD-04]` but not `requirements-completed`)

### Phase 11: Interactive Kanban
- Verification status `human_needed` — drag-and-drop requires live browser testing

### Total: 3 items across 3 phases

---

_Audited: 2026-02-22T14:30:00Z_
_Auditor: Claude (gsd audit-milestone)_
