---
phase: 11-interactive-kanban
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [app.js, style.css]
autonomous: true
requirements: [KNBN-01, KNBN-02, KNBN-03]

must_haves:
  truths:
    - "Authenticated user can drag a kanban card from one column and drop it on another"
    - "A confirmation modal appears after drop, naming the task title and destination column"
    - "After confirming, the card appears in the new column and the change is persisted via GitHub Contents API"
    - "Drag handles and drop zones are not present when the user is not authenticated"
    - "Dropping a card on its own column does nothing (no modal, no write)"
  artifacts:
    - path: "app.js"
      provides: "wireDragAndDrop function, showMoveModal function, extended renderKanban with draggable cards and data attributes"
      contains: "wireDragAndDrop"
    - path: "style.css"
      provides: "Drag feedback CSS (card-dragging opacity, grab cursor, col-drop-over highlight)"
      contains: "card-dragging"
  key_links:
    - from: "app.js renderKanban()"
      to: "wireDragAndDrop()"
      via: "Called after innerHTML set, only when authenticated"
      pattern: "if.*isAuth.*wireDragAndDrop"
    - from: "app.js showMoveModal()"
      to: "getFile() and writeFile()"
      via: "Confirm button handler fetches fresh SHA then writes updated task JSON"
      pattern: "getFile.*data/kanban.*writeFile"
    - from: "app.js showMoveModal()"
      to: "renderKanban()"
      via: "Re-renders board after successful write"
      pattern: "await renderKanban"
---

<objective>
Add interactive drag-and-drop to the kanban board so authenticated users can move cards between columns, confirm the move via a modal, and persist the column change to GitHub.

Purpose: Completes the final phase of v2.0 — kanban cards become interactive for authenticated users, using the same GitHub API wrapper and modal patterns established in Phases 9-10.
Output: Extended `renderKanban()` with draggable cards, `wireDragAndDrop()` for HTML5 DnD events, `showMoveModal()` for confirmation, and CSS for drag feedback.
</objective>

<execution_context>
@/Users/enjat/.claude/get-shit-done/workflows/execute-plan.md
@/Users/enjat/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-interactive-kanban/11-RESEARCH.md
@.planning/phases/10-site-doc-crud/10-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend renderKanban with draggable cards, wireDragAndDrop, and showMoveModal</name>
  <files>app.js</files>
  <action>
Modify `renderKanban()` in app.js (starts at line 111) to add drag-and-drop support:

**1. Add `isAuth` check and conditional `draggable` attribute on cards:**

At the top of the try block (after fetching taskFiles), add:
```javascript
const isAuth = document.body.classList.contains('authenticated');
```

In the card template string (currently line 148), change from:
```javascript
return `<div class="kanban-card">
```
to:
```javascript
const draggableAttr = isAuth ? 'draggable="true"' : '';
return `<div class="kanban-card" ${draggableAttr} data-task-id="${escapeHtml(task.id)}" data-task-title="${escapeHtml(task.title || '')}">
```

**2. Add `data-col-name` to column containers:**

In the column template string (currently line 155), change from:
```javascript
return `<div class="kanban-column column-${cls}">
```
to:
```javascript
return `<div class="kanban-column column-${cls}" data-col-name="${escapeHtml(colName)}">
```

**3. Call `wireDragAndDrop()` after innerHTML is set:**

After `mainEl.innerHTML = ...` (currently line 161), add:
```javascript
if (isAuth) {
  wireDragAndDrop();
}
```

**4. Add `wireDragAndDrop()` function** (place it inside the Kanban Board View section, right after `renderKanban`):

```javascript
function wireDragAndDrop() {
  let draggedTaskId = null;
  let draggedTaskTitle = null;
  let draggedSourceColumn = null;

  mainEl.querySelectorAll('.kanban-card[draggable]').forEach(card => {
    card.addEventListener('dragstart', (e) => {
      draggedTaskId = card.dataset.taskId;
      draggedTaskTitle = card.dataset.taskTitle;
      draggedSourceColumn = card.closest('.kanban-column').dataset.colName;
      e.dataTransfer.effectAllowed = 'move';
      e.dataTransfer.setData('text/plain', draggedTaskId);
      card.classList.add('card-dragging');
    });

    card.addEventListener('dragend', () => {
      card.classList.remove('card-dragging');
      draggedTaskId = null;
      draggedTaskTitle = null;
      draggedSourceColumn = null;
    });
  });

  mainEl.querySelectorAll('.kanban-column').forEach(col => {
    col.addEventListener('dragover', (e) => {
      // CRITICAL: Must call preventDefault() or drop event will never fire
      if (e.dataTransfer.types.includes('text/plain')) {
        e.preventDefault();
        col.classList.add('col-drop-over');
      }
    });

    col.addEventListener('dragleave', (e) => {
      // Only remove highlight when truly leaving the column (not entering a child)
      if (!col.contains(e.relatedTarget)) {
        col.classList.remove('col-drop-over');
      }
    });

    col.addEventListener('drop', (e) => {
      e.preventDefault();
      col.classList.remove('col-drop-over');
      const targetColumn = col.dataset.colName;

      if (!draggedTaskId || targetColumn === draggedSourceColumn) return;

      showMoveModal(draggedTaskId, draggedTaskTitle, targetColumn);
    });
  });
}
```

**5. Add `showMoveModal()` function** (place it after `wireDragAndDrop`, still in the Kanban Board View section):

Follow the exact same pattern as `showDeleteModal` (line 587):

```javascript
function showMoveModal(taskId, taskTitle, targetColumn) {
  document.getElementById('move-modal')?.remove();

  const overlay = document.createElement('div');
  overlay.id = 'move-modal';
  overlay.className = 'modal-overlay';
  overlay.innerHTML = `
    <div class="modal-box">
      <h2>Move task?</h2>
      <p>Move <strong>${escapeHtml(taskTitle)}</strong> to <strong>${escapeHtml(targetColumn)}</strong>?</p>
      <p id="move-modal-error" class="form-error" hidden></p>
      <div class="modal-actions">
        <button id="confirm-move-btn" class="btn-action">Move</button>
        <button id="cancel-move-btn" class="btn-action btn-secondary">Cancel</button>
      </div>
    </div>
  `;
  document.body.appendChild(overlay);

  document.getElementById('cancel-move-btn').addEventListener('click', () => overlay.remove());
  overlay.addEventListener('click', e => { if (e.target === overlay) overlay.remove(); });

  document.getElementById('confirm-move-btn').addEventListener('click', async () => {
    const confirmBtn = document.getElementById('confirm-move-btn');
    const errorEl = document.getElementById('move-modal-error');
    confirmBtn.disabled = true;
    confirmBtn.textContent = 'Moving...';
    errorEl.hidden = true;

    try {
      const taskFile = await getFile(`data/kanban/${taskId}.json`);
      const taskData = JSON.parse(taskFile.content);
      taskData.column = targetColumn;
      await writeFile(
        `data/kanban/${taskId}.json`,
        JSON.stringify(taskData, null, 2),
        `kanban: move ${taskId} to ${targetColumn}`
      );
      overlay.remove();
      await renderKanban();
    } catch (err) {
      errorEl.textContent = 'Move failed: ' + (err.message || 'Check your connection and try again.');
      errorEl.hidden = false;
      confirmBtn.disabled = false;
      confirmBtn.textContent = 'Move';
    }
  });
}
```

**Key details:**
- `showMoveModal` reuses `.modal-overlay`, `.modal-box`, `.modal-actions`, `.form-error` CSS classes already defined in style.css from Phase 10
- `getFile` fetches fresh SHA at confirm time (not at drag-start) per Phase 9 SHA discipline
- `writeFile` and `getFile` are global functions from github.js (Phase 9)
- `escapeHtml` is a global function from the Utility section of app.js
- After successful write, `await renderKanban()` re-renders the board from fresh data
- No-op when dropping a card on its own column (source === target check)
  </action>
  <verify>Open app.js and confirm: (1) renderKanban card template includes conditional `draggable="true"` and `data-task-id`/`data-task-title` attributes, (2) column template includes `data-col-name`, (3) `wireDragAndDrop()` called after innerHTML when authenticated, (4) `wireDragAndDrop` function exists with dragstart/dragend/dragover/dragleave/drop handlers, (5) `showMoveModal` function exists with getFile+writeFile+renderKanban pattern, (6) dragover handler calls `e.preventDefault()`, (7) drop handler checks source !== target before showing modal</verify>
  <done>renderKanban renders draggable cards with data attributes when authenticated, wireDragAndDrop wires HTML5 DnD events on cards and columns, showMoveModal shows confirmation modal and persists column change via GitHub API on confirm, no-op drops on same column are silently ignored</done>
</task>

<task type="auto">
  <name>Task 2: Add drag feedback CSS styles</name>
  <files>style.css</files>
  <action>
Add the following CSS rules to style.css, in the Kanban Board section (near the existing `.kanban-board`, `.kanban-column`, `.kanban-card` rules):

```css
/* Drag-and-drop feedback */
.kanban-card.card-dragging {
  opacity: 0.4;
}

.kanban-card[draggable="true"] {
  cursor: grab;
}

.kanban-card[draggable="true"]:active {
  cursor: grabbing;
}

.kanban-column.col-drop-over {
  outline: 2px dashed var(--accent);
  outline-offset: -2px;
  background: rgba(74, 158, 255, 0.08);
}
```

These four rules provide:
1. **card-dragging**: Dims the card being dragged (opacity 0.4) so the user sees which card is in motion
2. **draggable cursor**: Shows grab cursor on hover for draggable cards — visual affordance that cards are interactive
3. **grabbing cursor**: Shows grabbing cursor while actively dragging
4. **col-drop-over**: Highlights the target column with a dashed accent-color outline and subtle blue background tint when a card is dragged over it

Use `var(--accent)` for the outline color to stay consistent with the project's CSS variable system. The `rgba(74, 158, 255, 0.08)` matches the accent blue at low opacity for a subtle background tint.
  </action>
  <verify>Open style.css and confirm: (1) `.kanban-card.card-dragging` rule with `opacity: 0.4`, (2) `.kanban-card[draggable="true"]` with `cursor: grab`, (3) `.kanban-card[draggable="true"]:active` with `cursor: grabbing`, (4) `.kanban-column.col-drop-over` with outline and background styles</verify>
  <done>Drag feedback CSS is in place: dragging card is dimmed, draggable cards show grab cursor, drop target column is highlighted with dashed accent outline</done>
</task>

</tasks>

<verification>
1. Open the site in a browser, navigate to `#/kanban`
2. When NOT authenticated: cards should NOT have `draggable="true"` attribute, no grab cursor on hover
3. Authenticate with a GitHub PAT
4. Cards now show grab cursor on hover and have `draggable="true"` attribute
5. Drag a card from one column to another — the source card dims (opacity 0.4), the target column highlights with a dashed blue outline
6. Drop the card on a different column — a modal appears saying "Move **[task title]** to **[column name]**?"
7. Click Cancel — modal closes, card returns to original position, no API call
8. Drag and drop again, click Move — button says "Moving...", then modal closes and the board re-renders with the card in the new column
9. Refresh the page — the card is still in the new column (persisted via GitHub API)
10. Drag a card and drop it on the SAME column — nothing happens (no modal)
</verification>

<success_criteria>
- Authenticated users can drag kanban cards between columns via HTML5 Drag and Drop
- Confirmation modal appears naming task title and destination column before any write
- Column change is persisted to GitHub via writeFile and reflected on board re-render
- Drag handles (grab cursor, draggable attribute) are absent when not authenticated
- Drop-zone visual feedback (column highlight) appears during drag-over
- No-op drops on same column produce no modal and no API call
</success_criteria>

<output>
After completion, create `.planning/phases/11-interactive-kanban/11-01-SUMMARY.md`
</output>
