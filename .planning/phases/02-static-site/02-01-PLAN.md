---
phase: 02-static-site
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - index.html
  - style.css
  - app.js
  - data/docs/index.json
  - .github/workflows/deploy.yml
autonomous: true
requirements: [SITE-01, SITE-02, SITE-05, SITE-06, SITE-07, SITE-08]

must_haves:
  truths:
    - "Opening index.html locally shows a dark-themed SPA with sidebar listing Docs, Kanban, and Progress nav links"
    - "Clicking a doc link in the sidebar renders its markdown content in the main area with XSS-safe HTML"
    - "Active sidebar link is visually highlighted when navigating between views"
    - "All fetch paths use relative URLs (no leading slash) for GitHub Pages subdirectory compatibility"
    - "GitHub Actions workflow file exists and will deploy on push to main"
  artifacts:
    - path: "index.html"
      provides: "SPA shell with CDN scripts, sidebar, main content area"
      contains: "marked.umd.js"
    - path: "style.css"
      provides: "Dark theme with CSS custom properties, responsive sidebar+main layout"
      contains: "--bg-primary"
    - path: "app.js"
      provides: "Hash router, doc rendering with marked+DOMPurify, active nav highlighting"
      contains: "hashchange"
    - path: "data/docs/index.json"
      provides: "Doc registry listing available markdown files for sidebar and future MCP"
      contains: "architecture"
    - path: ".github/workflows/deploy.yml"
      provides: "GitHub Actions no-build deploy to Pages"
      contains: "deploy-pages"
  key_links:
    - from: "app.js"
      to: "data/docs/index.json"
      via: "fetch in renderDocView to list available docs"
      pattern: "fetch.*data/docs/index\\.json"
    - from: "app.js"
      to: "data/docs/*.md"
      via: "fetch in renderDoc to load markdown content"
      pattern: "fetch.*data/docs/.*\\.md"
    - from: "app.js"
      to: "marked.parse + DOMPurify.sanitize"
      via: "render pipeline for markdown"
      pattern: "DOMPurify\\.sanitize.*marked\\.parse"
    - from: "index.html"
      to: "app.js"
      via: "script tag with defer"
      pattern: "app\\.js.*defer"
---

<objective>
Create the SPA shell, dark theme, hash-based routing, markdown doc rendering, docs registry, and GitHub Actions deploy workflow.

Purpose: Establish the foundational site structure that all views render into, with the first working view (docs) proving the full fetch-parse-render pipeline end-to-end.
Output: A working site that loads locally, renders docs from markdown files, navigates via hash routing, and has a CI/CD workflow ready for GitHub Pages deployment.
</objective>

<execution_context>
@/Users/enjat/.claude/get-shit-done/workflows/execute-plan.md
@/Users/enjat/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-static-site/02-RESEARCH.md
@.planning/phases/01-data-layer/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SPA shell, dark theme CSS, and docs registry</name>
  <files>index.html, style.css, data/docs/index.json</files>
  <action>
Create `index.html` at repo root as the SPA shell:
- DOCTYPE html with `<html lang="en">`
- `<head>`: meta charset, viewport, title "Keloia Docs", link to `style.css`
- CDN scripts loaded in order (NO async/defer on CDN tags — app.js depends on their globals):
  - `https://cdn.jsdelivr.net/npm/marked/lib/marked.umd.js`
  - `https://cdn.jsdelivr.net/npm/dompurify/dist/purify.min.js`
- `<script src="app.js" defer></script>` AFTER CDN scripts
- `<body>` with flex layout:
  - `<nav id="sidebar">`: logo/title area, then three nav sections:
    - "Docs" section with a `<ul id="doc-list">` (populated dynamically by app.js)
    - "Views" section with links: `<a href="#/kanban" data-view="kanban">Kanban</a>`, `<a href="#/progress" data-view="progress">Progress</a>`
  - `<main id="main">` — content area where views render

Create `style.css` at repo root with dark theme:
- CSS custom properties on `:root`:
  - `--bg-primary: #1a1a2e`, `--bg-secondary: #16213e`, `--bg-card: #1e2a45`
  - `--text-primary: #e0e0e0`, `--text-secondary: #a0a0b0`
  - `--accent: #4a9eff`, `--border: #2d2d4a`
  - `--sidebar-width: 260px`
  - Column colors for kanban (used in Plan 02): `--col-backlog: #6c757d`, `--col-in-progress: #4a9eff`, `--col-done: #2ed573`
- Reset: `*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }`
- `body`: flex, min-height 100vh, bg-primary, text-primary, system-ui font, margin 0
- `#sidebar`: width var(--sidebar-width), bg-secondary, border-right, flex-shrink 0, padding 1rem, overflow-y auto, height 100vh, position sticky, top 0
- Sidebar nav styling: section headings (h3), link list items, `.active` class with accent color + left border
- `#main`: flex 1, padding 2rem, overflow-y auto, max-width for readability
- Markdown content styling in `#main`: headings, paragraphs, code blocks (with bg-card background), lists, links (accent color), blockquotes, tables
- Responsive: `@media (max-width: 768px)` — sidebar becomes top bar or hidden with toggle, main takes full width

Create `data/docs/index.json` — doc registry for sidebar population and future MCP `list_docs`:
```json
{
  "schemaVersion": 1,
  "docs": [
    { "slug": "architecture", "title": "Architecture" },
    { "slug": "value-proposition", "title": "Value Proposition" }
  ]
}
```
  </action>
  <verify>
- `index.html` exists at repo root, contains marked.umd.js and purify.min.js script tags, contains `id="sidebar"` and `id="main"`
- `style.css` exists at repo root, contains `--bg-primary` custom property and `#sidebar` styles
- `data/docs/index.json` exists with schemaVersion 1 and two doc entries
- Opening `index.html` in a browser (via `open index.html` or local server) shows a dark-themed page with a sidebar
  </verify>
  <done>SPA shell renders with dark theme, sidebar has navigation sections, docs registry lists both seed documents</done>
</task>

<task type="auto">
  <name>Task 2: Create hash router with doc rendering and active nav</name>
  <files>app.js</files>
  <action>
Create `app.js` at repo root with all routing and doc rendering logic:

**Router setup:**
- `router()` function reads `window.location.hash`, splits on `/` to extract view and param
- Routes: `#/docs` (doc list default), `#/docs/{slug}` (specific doc), `#/kanban`, `#/progress`
- Default route (empty hash or `#/`) redirects to `#/docs`
- Listen on both `hashchange` and `DOMContentLoaded` events

**Doc sidebar population (on load):**
- Fetch `data/docs/index.json` (relative path, no leading slash)
- Populate `#doc-list` with `<li><a href="#/docs/{slug}">{title}</a></li>` for each doc
- Each doc link gets `data-view="docs"` for active nav tracking

**Doc rendering (`renderDoc(slug)`):**
- If no slug provided, fetch `data/docs/index.json` and use first doc's slug as default
- Fetch `data/docs/${slug}.md` (relative path)
- On fetch failure (404), show "Document not found" message in `#main`
- Parse with `marked.parse(markdown)` then sanitize with `DOMPurify.sanitize(rawHtml, { USE_PROFILES: { html: true } })`
- Assign sanitized HTML to `document.getElementById('main').innerHTML`

**Active nav highlighting (`updateActiveNav(view, param)`):**
- Remove `.active` class from all sidebar links
- For docs view: match `a[href="#/docs/${param}"]` and add `.active`
- For kanban/progress: match `a[data-view="${view}"]` and add `.active`

**Placeholder views (will be implemented in Plan 02):**
- `renderKanban()` — shows "Kanban board loading..." placeholder in `#main`
- `renderProgress()` — shows "Progress tracker loading..." placeholder in `#main`

**CRITICAL path rules (SITE-07):**
- ALL fetch calls use relative paths: `data/docs/index.json` NOT `/data/docs/index.json`
- No leading slash anywhere in any URL string
  </action>
  <verify>
- `app.js` exists at repo root
- Contains `hashchange` event listener
- Contains `marked.parse` call
- Contains `DOMPurify.sanitize` call
- Contains `data/docs/index.json` fetch (no leading slash)
- Does NOT contain any fetch path starting with `/` (grep for `fetch('/' or fetch("/"`)
- Opening `index.html` and navigating to `#/docs/architecture` renders the architecture doc content
- Navigating to `#/docs/value-proposition` renders value proposition content
- Navigating to `#/kanban` shows placeholder text
- Active sidebar link changes on navigation
  </verify>
  <done>Hash routing works for all views, docs render from markdown with XSS protection, active nav highlights correctly, all paths are relative</done>
</task>

<task type="auto">
  <name>Task 3: Create GitHub Actions deploy workflow</name>
  <files>.github/workflows/deploy.yml</files>
  <action>
Create `.github/workflows/deploy.yml` using the official GitHub Pages static site starter pattern:

```yaml
name: Deploy static content to Pages

on:
  push:
    branches: [main]
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Setup Pages
        uses: actions/configure-pages@v5
      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: '.'
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
```

This is the exact official starter workflow. `path: '.'` uploads the entire repo root as the Pages artifact. The `configure-pages` step injects the base URL for the project site.

NOTE for user: After pushing this workflow, the repository's Pages source must be set to "GitHub Actions" in Settings > Pages > Source. This is a one-time manual setting (cannot be done via CLI).
  </action>
  <verify>
- `.github/workflows/deploy.yml` exists
- Contains `actions/deploy-pages@v4`
- Contains `permissions: pages: write` and `id-token: write`
- YAML is valid (no syntax errors)
  </verify>
  <done>GitHub Actions workflow file exists and is correctly configured to deploy the repo root to GitHub Pages on push to main</done>
</task>

</tasks>

<verification>
1. Open `index.html` in a browser — dark theme renders, sidebar visible with doc links and view links
2. Click "Architecture" in sidebar — markdown content renders in main area
3. Click "Value Proposition" — different doc renders, active link changes
4. Click "Kanban" — placeholder shows, active link changes
5. Click "Progress" — placeholder shows, active link changes
6. Check browser DevTools Network tab — no requests with absolute paths (no leading `/`)
7. Verify `.github/workflows/deploy.yml` exists with correct content
8. Verify `data/docs/index.json` exists with both doc entries
</verification>

<success_criteria>
- SPA shell loads with dark theme and responsive layout
- Hash routing navigates between docs, kanban placeholder, and progress placeholder
- Markdown docs render with marked.js + DOMPurify sanitization pipeline
- Sidebar doc list populated dynamically from `data/docs/index.json`
- Active sidebar link highlighted on navigation
- All fetch paths use relative URLs (no leading slash)
- GitHub Actions deploy workflow ready for push
</success_criteria>

<output>
After completion, create `.planning/phases/02-static-site/02-01-SUMMARY.md`
</output>
