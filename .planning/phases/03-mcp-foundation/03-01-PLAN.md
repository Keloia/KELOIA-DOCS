---
phase: 03-mcp-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - mcp-server/package.json
  - mcp-server/tsconfig.json
  - mcp-server/src/index.ts
  - mcp-server/src/server.ts
  - mcp-server/src/transport.ts
  - mcp-server/src/paths.ts
  - mcp-server/src/tools/read.ts
  - mcp-server/src/tools/write.ts
  - mcp-server/src/utils/.gitkeep
  - mcp-server/src/types/.gitkeep
  - mcp-server/.gitignore
autonomous: true
requirements:
  - MCP-01
  - MCP-02
  - MCP-03
  - MCP-05

must_haves:
  truths:
    - "`npm run build` in mcp-server/ produces dist/index.js with zero TypeScript errors"
    - "`node dist/index.js` starts the server process (exits cleanly on Ctrl+C)"
    - "All path constants (REPO_ROOT, DOCS_DIR, KANBAN_DIR, PROGRESS_DIR) log correct absolute paths to stderr at startup"
    - "Zero console.log() calls exist in mcp-server/src/"
    - "Transport wiring is in a separate module from server construction"
  artifacts:
    - path: "mcp-server/package.json"
      provides: "Standalone package with type: module, dependencies, dev scripts"
      contains: "type.*module"
    - path: "mcp-server/tsconfig.json"
      provides: "TypeScript config with Node16 module resolution"
      contains: "Node16"
    - path: "mcp-server/src/index.ts"
      provides: "Thin entry point — imports server + transport, logs paths, connects"
      min_lines: 8
    - path: "mcp-server/src/server.ts"
      provides: "McpServer construction"
      exports: ["createServer"]
    - path: "mcp-server/src/transport.ts"
      provides: "StdioServerTransport wiring (swappable layer for MCP-05)"
      exports: ["connectStdio"]
    - path: "mcp-server/src/paths.ts"
      provides: "Path constants derived from import.meta.url"
      exports: ["REPO_ROOT", "DOCS_DIR", "KANBAN_DIR", "PROGRESS_DIR"]
  key_links:
    - from: "mcp-server/src/index.ts"
      to: "mcp-server/src/server.ts"
      via: "import createServer"
      pattern: 'import.*createServer.*from.*"./server.js"'
    - from: "mcp-server/src/index.ts"
      to: "mcp-server/src/transport.ts"
      via: "import connectStdio"
      pattern: 'import.*connectStdio.*from.*"./transport.js"'
    - from: "mcp-server/src/index.ts"
      to: "mcp-server/src/paths.ts"
      via: "import path constants"
      pattern: 'import.*REPO_ROOT.*from.*"./paths.js"'
    - from: "mcp-server/src/transport.ts"
      to: "@modelcontextprotocol/sdk"
      via: "StdioServerTransport import"
      pattern: "StdioServerTransport"
---

<objective>
Create the MCP server skeleton in `mcp-server/` with all source modules, TypeScript toolchain, and npm scripts — a zero-tool server that compiles and runs.

Purpose: Prove the toolchain (tsc + tsx), module system (ESM with Node16), path resolution (import.meta.url), and stdout discipline (console.error only) are correct before any tool code is written in later phases.

Output: A buildable, runnable MCP server skeleton with modular source organization ready for tool registration in phases 4-5.
</objective>

<execution_context>
@/Users/enjat/.claude/get-shit-done/workflows/execute-plan.md
@/Users/enjat/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-mcp-foundation/03-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create mcp-server package with TypeScript toolchain</name>
  <files>
    mcp-server/package.json
    mcp-server/tsconfig.json
    mcp-server/.gitignore
  </files>
  <action>
Create `mcp-server/` directory at the repo root.

**package.json** — standalone ESM package:
```json
{
  "name": "keloia-mcp-server",
  "version": "1.0.0",
  "type": "module",
  "main": "dist/index.js",
  "scripts": {
    "dev": "tsx src/index.ts",
    "dev:watch": "tsx watch src/index.ts",
    "build": "tsc",
    "start": "node dist/index.js"
  },
  "dependencies": {
    "@modelcontextprotocol/sdk": "^1.7.0",
    "zod": "^3.25.0"
  },
  "devDependencies": {
    "@types/node": "^22.0.0",
    "typescript": "^5.7.0",
    "tsx": "^4.19.0"
  }
}
```

**tsconfig.json** — Node16 module resolution with strict mode:
```json
{
  "compilerOptions": {
    "target": "ES2022",
    "module": "Node16",
    "moduleResolution": "Node16",
    "outDir": "./dist",
    "rootDir": "./src",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true
  },
  "include": ["src/**/*"],
  "exclude": ["node_modules", "dist"]
}
```

**`.gitignore`** — ignore node_modules and dist:
```
node_modules/
dist/
```

Then run `cd mcp-server && npm install` to install all dependencies.

CRITICAL constraints:
- `"type": "module"` is REQUIRED (SDK is ESM-only)
- `moduleResolution: "Node16"` means all relative imports in source MUST use `.js` extension
- Do NOT use `ts-node` (broken with ESM in Node 20+, explicitly out of scope)
  </action>
  <verify>
Run from mcp-server/:
1. `ls node_modules/@modelcontextprotocol/sdk` — SDK installed
2. `ls node_modules/zod` — Zod installed
3. `cat package.json | grep '"type": "module"'` — ESM enabled
4. `npx tsc --version` — TypeScript available
  </verify>
  <done>
mcp-server/ exists with package.json (type: module), tsconfig.json (Node16), .gitignore, and all dependencies installed in node_modules/
  </done>
</task>

<task type="auto">
  <name>Task 2: Create server source modules and build</name>
  <files>
    mcp-server/src/paths.ts
    mcp-server/src/server.ts
    mcp-server/src/transport.ts
    mcp-server/src/index.ts
    mcp-server/src/tools/read.ts
    mcp-server/src/tools/write.ts
    mcp-server/src/utils/.gitkeep
    mcp-server/src/types/.gitkeep
  </files>
  <action>
Create the following source files. All relative imports MUST use `.js` extension (Node16 requirement).

**src/paths.ts** — path constants from import.meta.url (MCP-03):
```typescript
import { fileURLToPath } from "node:url";
import { dirname, join } from "node:path";
import { existsSync } from "node:fs";

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

// dist/paths.js → dirname = dist/ → .. = mcp-server/ → .. = repo root
export const REPO_ROOT = join(__dirname, "..", "..");
export const DOCS_DIR = join(REPO_ROOT, "data", "docs");
export const KANBAN_DIR = join(REPO_ROOT, "data", "kanban");
export const PROGRESS_DIR = join(REPO_ROOT, "data", "progress");

/** Log resolved paths to stderr and warn if directories don't exist. */
export function logPaths(): void {
  console.error("[keloia-mcp] REPO_ROOT:", REPO_ROOT);
  console.error("[keloia-mcp] DOCS_DIR:", DOCS_DIR);
  console.error("[keloia-mcp] KANBAN_DIR:", KANBAN_DIR);
  console.error("[keloia-mcp] PROGRESS_DIR:", PROGRESS_DIR);

  for (const [name, dir] of [["DOCS_DIR", DOCS_DIR], ["KANBAN_DIR", KANBAN_DIR], ["PROGRESS_DIR", PROGRESS_DIR]] as const) {
    if (!existsSync(dir)) {
      console.error(`[keloia-mcp] WARNING: ${name} does not exist: ${dir}`);
    }
  }
}
```

**src/server.ts** — McpServer construction (v1.x SDK):
```typescript
import { McpServer } from "@modelcontextprotocol/sdk/server/mcp.js";

export function createServer(): McpServer {
  const server = new McpServer({
    name: "keloia",
    version: "1.0.0",
  });
  // Tools registered here in phases 4-5
  return server;
}
```

**src/transport.ts** — StdioServerTransport wiring, separate module for MCP-05 swappability:
```typescript
import { StdioServerTransport } from "@modelcontextprotocol/sdk/server/stdio.js";
import type { McpServer } from "@modelcontextprotocol/sdk/server/mcp.js";

export async function connectStdio(server: McpServer): Promise<void> {
  const transport = new StdioServerTransport();
  await server.connect(transport);
}
```

**src/index.ts** — thin entry point:
```typescript
import { createServer } from "./server.js";
import { connectStdio } from "./transport.js";
import { logPaths } from "./paths.js";

// Log resolved paths to stderr at startup (MCP-03 verification)
logPaths();

const server = createServer();
await connectStdio(server);
```

**src/tools/read.ts** — placeholder for Phase 4:
```typescript
// Read tools (keloia_list_docs, keloia_read_doc, keloia_get_kanban, keloia_get_progress)
// Implemented in Phase 4
export {};
```

**src/tools/write.ts** — placeholder for Phase 5:
```typescript
// Write tools (keloia_add_task, keloia_move_task, keloia_update_progress)
// Implemented in Phase 5
export {};
```

**src/utils/.gitkeep** — empty file to preserve directory
**src/types/.gitkeep** — empty file to preserve directory

After creating all files, run `cd mcp-server && npm run build` to compile. Verify dist/index.js exists.

CRITICAL:
- ZERO `console.log()` in any src/ file — only `console.error()` (MCP-02: stdout is the JSON-RPC channel)
- ALL relative imports use `.js` extension (e.g., `"./server.js"` not `"./server"`)
- `import.meta.url` for path resolution, NEVER `process.cwd()` (MCP-03)
- Transport is a separate module from server construction (MCP-05)
  </action>
  <verify>
Run from mcp-server/:
1. `npm run build` — zero TypeScript errors, produces dist/index.js
2. `grep -r "console.log" src/` — returns zero results (MCP-02)
3. `grep -r "process.cwd" src/` — returns zero results (MCP-03)
4. `grep -r 'from "./[^"]*[^j][^s]"' src/` — no relative imports missing .js extension
5. `node dist/index.js &amp; PID=$!; sleep 1; kill $PID` — starts without crash (will hang waiting for stdin, which is correct stdio behavior)
  </verify>
  <done>
All source files created with correct ESM imports. `npm run build` produces dist/index.js with zero errors. Zero console.log in source. Transport layer is a separate module from server construction. Path constants derived from import.meta.url log correct absolute paths to stderr.
  </done>
</task>

</tasks>

<verification>
1. `cd mcp-server && npm run build` exits 0 with no errors
2. `ls mcp-server/dist/index.js` exists
3. `grep -r "console.log" mcp-server/src/` returns empty (zero stdout pollution)
4. `grep -r "process.cwd" mcp-server/src/` returns empty (no cwd-based paths)
5. `node mcp-server/dist/index.js 2>&1 1>/dev/null | head -5` shows [keloia-mcp] path lines on stderr
6. Source structure: index.ts, server.ts, transport.ts, paths.ts, tools/, utils/, types/ all exist
</verification>

<success_criteria>
- mcp-server/ is a standalone ESM package with all dependencies installed
- `npm run build` compiles with zero TypeScript errors
- Server process starts and logs correct absolute paths to stderr
- Zero console.log() in source (stdout discipline)
- Zero process.cwd() in source (path resolution discipline)
- Transport wiring is in transport.ts, separate from server.ts (swappable)
- Placeholder directories exist for future phases (tools/, utils/, types/)
</success_criteria>

<output>
After completion, create `.planning/phases/03-mcp-foundation/03-01-SUMMARY.md`
</output>
