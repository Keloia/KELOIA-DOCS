---
phase: 04-read-tools
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - mcp-server/src/tools/read.ts
  - mcp-server/src/server.ts
autonomous: true
requirements:
  - READ-01
  - READ-02
  - READ-03
  - READ-04
  - READ-05
  - INTG-01
  - INTG-02

must_haves:
  truths:
    - "Four MCP tools are registered: keloia_list_docs, keloia_read_doc, keloia_get_kanban, keloia_get_progress"
    - "keloia_list_docs returns documentation slugs and titles from data/docs/index.json"
    - "keloia_read_doc reads a markdown file by slug with optional pagination"
    - "keloia_get_kanban returns denormalized board with columns and embedded task objects"
    - "keloia_get_progress returns all milestones with status and task counts"
    - "Invalid inputs (bad slug, missing file) return isError: true with a human-readable message"
    - "All tool names are prefixed with keloia_ and descriptions are action-first for accurate AI tool selection"
  artifacts:
    - path: "mcp-server/src/tools/read.ts"
      provides: "All four read tool implementations with error handling"
      exports: ["registerReadTools"]
    - path: "mcp-server/src/server.ts"
      provides: "Server creation with read tools registered"
      contains: "registerReadTools"
  key_links:
    - from: "mcp-server/src/server.ts"
      to: "mcp-server/src/tools/read.ts"
      via: "import registerReadTools and call it on the server instance"
      pattern: "registerReadTools\\(server\\)"
    - from: "mcp-server/src/tools/read.ts"
      to: "mcp-server/src/paths.ts"
      via: "import DOCS_DIR, KANBAN_DIR, PROGRESS_DIR path constants"
      pattern: "import.*DOCS_DIR.*KANBAN_DIR.*PROGRESS_DIR.*from.*paths"
    - from: "mcp-server/src/tools/read.ts"
      to: "data/docs/index.json"
      via: "readFileSync for doc listing and slug validation"
      pattern: "readFileSync.*DOCS_DIR.*index\\.json"
    - from: "mcp-server/src/tools/read.ts"
      to: "data/kanban/index.json"
      via: "readFileSync for kanban index, then fan-out to task files"
      pattern: "readFileSync.*KANBAN_DIR.*index\\.json"
    - from: "mcp-server/src/tools/read.ts"
      to: "data/progress/index.json"
      via: "readFileSync for progress index, then fan-out to milestone files"
      pattern: "readFileSync.*PROGRESS_DIR.*index\\.json"
---

<objective>
Implement the four keloia read tools and register them with the MCP server.

Purpose: Claude Code needs to query project documentation, kanban board state, and milestone progress via MCP tools. This is the core functionality of the Phase 4 read tools requirement.

Output: `mcp-server/src/tools/read.ts` with all four tool implementations and `mcp-server/src/server.ts` updated to register them. Project builds with zero TypeScript errors.
</objective>

<execution_context>
@/Users/enjat/.claude/get-shit-done/workflows/execute-plan.md
@/Users/enjat/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-read-tools/04-RESEARCH.md

@mcp-server/src/server.ts
@mcp-server/src/paths.ts
@mcp-server/src/tools/read.ts
@data/docs/index.json
@data/kanban/index.json
@data/progress/index.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement four read tools in read.ts</name>
  <files>mcp-server/src/tools/read.ts</files>
  <action>
Replace the placeholder in `mcp-server/src/tools/read.ts` with the complete implementation of all four read tools. Follow the code patterns from 04-RESEARCH.md exactly.

**Imports:**
- `readFileSync` from `node:fs`
- `join` from `node:path`
- `z` from `zod`
- `McpServer` type from `@modelcontextprotocol/sdk/server/mcp.js`
- `DOCS_DIR`, `KANBAN_DIR`, `PROGRESS_DIR` from `../paths.js`

**Export a single function:** `registerReadTools(server: McpServer): void`

**Tool 1 — keloia_list_docs (READ-01, INTG-01, INTG-02):**
- Name: `keloia_list_docs`
- Description: "Lists all available documentation files in the keloia docs library. Returns an array of slugs and titles. Use slugs with keloia_read_doc to fetch document content."
- No inputSchema (no params)
- Handler: Read `data/docs/index.json`, return `index.docs` as pretty-printed JSON
- Error: Wrap in try/catch, return `{ isError: true, content: [...] }` on failure

**Tool 2 — keloia_read_doc (READ-02, READ-05, INTG-01, INTG-02):**
- Name: `keloia_read_doc`
- Description: "Reads the full markdown content of a keloia documentation file by its slug. Use keloia_list_docs first to discover valid slugs. Supports optional pagination via max_tokens (character limit) and offset (character start position) for large documents."
- inputSchema: `{ slug: z.string(), max_tokens: z.number().optional(), offset: z.number().optional() }` with `.describe()` on each
- Handler: (1) Read index.json, extract known slugs. (2) Validate slug is in list — if not, return isError with available slugs listed. (3) Read `${slug}.md` from DOCS_DIR. (4) Apply pagination: if offset or max_tokens provided, slice content. Use `content.slice(start, start + max_tokens)` pattern.
- Error: Wrap in try/catch for unexpected errors

**Tool 3 — keloia_get_kanban (READ-03, READ-05, INTG-01, INTG-02):**
- Name: `keloia_get_kanban`
- Description: "Returns the complete keloia kanban board with all columns and their tasks fully denormalized. Each column object contains an array of task objects (id, title, column, description, assignee). Use this to view all work items and their current status."
- No inputSchema
- Handler: (1) Read `data/kanban/index.json`. (2) For each taskId in `index.tasks`, read `${taskId}.json`. (3) Group tasks by column. (4) Return `{ columns: [...] }` as pretty-printed JSON.
- Error: Wrap in try/catch

**Tool 4 — keloia_get_progress (READ-04, READ-05, INTG-01, INTG-02):**
- Name: `keloia_get_progress`
- Description: "Returns milestone progress for all keloia project phases. Each milestone includes its status (done/in-progress/pending), total and completed task counts, and descriptive notes. Use this to check which phases are complete and what is in progress."
- No inputSchema
- Handler: (1) Read `data/progress/index.json`. (2) For each milestoneId in `index.milestones`, read `${milestoneId}.json`. (3) Return `{ milestones: [...] }` as pretty-printed JSON.
- Error: Wrap in try/catch

**CRITICAL constraints:**
- Use `server.registerTool()` (NOT deprecated `server.tool()`)
- inputSchema uses raw Zod shape (NOT wrapped in `z.object()`) — this is the v1.26.0 API
- Use `as const` on `type: "text"` in content items if needed to satisfy TypeScript literal type checking
- Never use `console.log()` — corrupts stdout JSON-RPC stream
- Never use `process.cwd()` — use imported path constants from `paths.ts`
- Never cache reads — always fresh off disk per requirements
- For `keloia_read_doc`: validate slug against known list BEFORE constructing file path (path traversal protection)
  </action>
  <verify>
Run `cd /Users/enjat/Github/keloia/keloia-docs/mcp-server && npm run build` — must complete with zero TypeScript errors. Then verify: `grep -c "registerTool" src/tools/read.ts` returns 4 (one per tool). `grep -c "console.log" src/tools/read.ts` returns 0.
  </verify>
  <done>
`read.ts` exports `registerReadTools` with all four tools registered via `server.registerTool()`. Each tool has a keloia_ prefix, action-first description, try/catch error handling returning isError, and reads data fresh from disk using path constants.
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire read tools into server.ts and build</name>
  <files>mcp-server/src/server.ts</files>
  <action>
Update `mcp-server/src/server.ts` to import and call `registerReadTools`:

1. Add import: `import { registerReadTools } from "./tools/read.js";` (note `.js` extension — Node16 ESM requirement)
2. In `createServer()`, replace the `// Tools registered here in phases 4-5` comment with `registerReadTools(server);`
3. Keep the comment updated if desired: `// Write tools registered in Phase 5`

Then build and verify:
1. Run `cd /Users/enjat/Github/keloia/keloia-docs/mcp-server && npm run build`
2. Verify build succeeds with zero errors
3. Run `node dist/index.js 2>/dev/null &` briefly to confirm the server starts without crashing (it will wait for stdio input — just verify no immediate error, then kill it)
  </action>
  <verify>
`npm run build` in mcp-server/ completes with zero errors. `grep "registerReadTools" mcp-server/src/server.ts` shows the import and the call. `grep "console.log" mcp-server/src/server.ts` returns 0 results.
  </verify>
  <done>
`server.ts` imports `registerReadTools` from `./tools/read.js` and calls it on the server instance inside `createServer()`. The project builds cleanly and the server starts without errors.
  </done>
</task>

</tasks>

<verification>
1. `cd mcp-server && npm run build` — zero TypeScript errors
2. `grep -r "console.log" mcp-server/src/` — zero results
3. `grep -c "registerTool" mcp-server/src/tools/read.ts` — exactly 4
4. `grep "keloia_" mcp-server/src/tools/read.ts` — shows all 4 tool names with keloia_ prefix
5. `grep "registerReadTools" mcp-server/src/server.ts` — shows import and call
6. `grep "isError" mcp-server/src/tools/read.ts` — shows error handling in all tools
</verification>

<success_criteria>
- Four tools registered: keloia_list_docs, keloia_read_doc, keloia_get_kanban, keloia_get_progress
- All tool names prefixed with keloia_ (INTG-01)
- All descriptions are action-first and distinguish tools from each other (INTG-02)
- keloia_read_doc validates slug against known list before path construction (READ-05 + path traversal)
- All tools return isError: true for error cases (READ-05)
- Project builds with zero TypeScript errors
- No console.log anywhere in src/
</success_criteria>

<output>
After completion, create `.planning/phases/04-read-tools/04-01-SUMMARY.md`
</output>
