---
milestone: v2.0
audited: 2026-02-22T14:00:00Z
status: tech_debt
scores:
  requirements: 23/23
  phases: 6/6
  integration: 19/23
  flows: 5/7
gaps:
  requirements: []
  integration:
    - id: "INT-01"
      severity: "medium"
      description: "Search index not invalidated after CRUD operations"
      affected_requirements: ["SRCH-01", "SRCH-02", "SRCH-03", "SRCH-04", "CRUD-01", "CRUD-02", "CRUD-04"]
      from_phase: "Phase 10 (Site Doc CRUD)"
      to_phase: "Phase 6 (Site Search)"
      evidence: "buildSearchIndex() runs once on first focus with { once: true }. After create/edit/delete, searchIndex is never reset — new docs absent from search, deleted docs remain searchable, edited content stale until page refresh."
      fix: "Add searchIndex = null after successful create, edit, and delete operations in app.js"
    - id: "INT-02"
      severity: "medium"
      description: "Edit route accessible without authentication via direct URL"
      affected_requirements: ["AUTH-04", "CRUD-02"]
      from_phase: "Phase 8 (GitHub Auth)"
      to_phase: "Phase 10 (Site Doc CRUD)"
      evidence: "Router at app.js dispatches #/docs/:slug/edit to renderEditView() without checking getAuthToken(). CSS hides edit buttons but direct URL navigation bypasses the gate. Save fails with error but edit form is fully visible."
      fix: "Add auth guard in router before renderEditView: if (!getAuthToken()) redirect to #/docs/:slug"
    - id: "INT-03"
      severity: "low"
      description: "Script load order is dependency-inverted"
      affected_requirements: []
      from_phase: "Phase 9 (GitHub API Wrapper)"
      to_phase: "Phase 8 (GitHub Auth)"
      evidence: "index.html loads app.js before github.js, but github.js calls getAuthToken() defined in app.js. Works at runtime due to lazy invocation but is a maintenance hazard."
      fix: "Swap script order in index.html: github.js before app.js"
    - id: "INT-04"
      severity: "low"
      description: "mcp-guide.md excluded from MCP tool access"
      affected_requirements: ["GUID-01"]
      from_phase: "Phase 6 (Site Search + Guide)"
      to_phase: "Phase 7 (MCP Search + CRUD)"
      evidence: "mcp-guide.md is not in data/docs/index.json. Site search hardcodes it into buildSearchIndex(), but MCP tools validate slugs against index.json — keloia_search_docs and keloia_read_doc cannot access the guide."
      fix: "Add mcp-guide to index.json or add special-case allowlist in MCP tools"
  flows:
    - id: "FLOW-01"
      flow: "Create doc → search for new doc"
      breaks_at: "Search index still contains pre-creation snapshot"
      affected_requirements: ["CRUD-01", "SRCH-01"]
    - id: "FLOW-02"
      flow: "Edit doc → search for edited content"
      breaks_at: "Search index contains original content from build time"
      affected_requirements: ["CRUD-02", "SRCH-01"]
tech_debt:
  - phase: 11-interactive-kanban
    items:
      - "Verification status is human_needed — drag-and-drop requires live browser testing"
  - phase: 10-site-doc-crud
    items:
      - "10-02-SUMMARY.md missing requirements-completed frontmatter field (has provides field instead)"
  - phase: cross-phase
    items:
      - "Search index stale after any CRUD operation (INT-01)"
      - "Edit route not auth-gated in router (INT-02)"
      - "Script load order inverted in index.html (INT-03)"
      - "mcp-guide invisible to MCP tools (INT-04)"
---

# Milestone v2.0 Audit: Search + Auth + CRUD

**Audited:** 2026-02-22
**Status:** tech_debt — all requirements met, no critical blockers, integration debt needs review

## Requirements Coverage (23/23)

All 23 v2.0 requirements are satisfied across the 3-source cross-reference.

### 3-Source Cross-Reference

| REQ-ID | Description | VERIFICATION | SUMMARY Frontmatter | REQUIREMENTS.md | Final |
|--------|-------------|-------------|---------------------|-----------------|-------|
| SRCH-01 | Search box in sidebar | passed (Ph6) | 06-01 | [x] | **satisfied** |
| SRCH-02 | Live search (debounced) | passed (Ph6) | 06-02 | [x] | **satisfied** |
| SRCH-03 | Results show name + snippet | passed (Ph6) | 06-02 | [x] | **satisfied** |
| SRCH-04 | Click result navigates | passed (Ph6) | 06-02 | [x] | **satisfied** |
| SRCH-05 | MCP keloia_search_docs | passed (Ph7) | 07-01 | [x] | **satisfied** |
| SRCH-06 | MCP search slug filter | passed (Ph7) | 07-01 | [x] | **satisfied** |
| AUTH-01 | PAT entry to authenticate | passed (Ph8) | 08-01 | [x] | **satisfied** |
| AUTH-02 | Token persists in localStorage | passed (Ph8) | 08-01 | [x] | **satisfied** |
| AUTH-03 | Logout clears token | passed (Ph8) | 08-01 | [x] | **satisfied** |
| AUTH-04 | Write controls hidden when unauth | passed (Ph8) | 08-01 | [x] | **satisfied** |
| CRUD-01 | Create new doc | passed (Ph10) | 10-02 provides | [x] | **satisfied** |
| CRUD-02 | Edit existing doc | passed (Ph10) | 10-01 | [x] | **satisfied** |
| CRUD-03 | Preview toggle while editing | passed (Ph10) | 10-01 | [x] | **satisfied** |
| CRUD-04 | Delete doc with confirmation | passed (Ph10) | 10-02 provides | [x] | **satisfied** |
| CRUD-05 | All writes via GitHub API | passed (Ph9) | 09-01 | [x] | **satisfied** |
| CRUD-06 | MCP keloia_add_doc | passed (Ph7) | 07-01 | [x] | **satisfied** |
| CRUD-07 | MCP keloia_edit_doc | passed (Ph7) | 07-01 | [x] | **satisfied** |
| CRUD-08 | MCP keloia_delete_doc | passed (Ph7) | 07-01 | [x] | **satisfied** |
| KNBN-01 | Drag cards between columns | passed (Ph11) | 11-01 | [x] | **satisfied** |
| KNBN-02 | Confirmation modal before save | passed (Ph11) | 11-01 | [x] | **satisfied** |
| KNBN-03 | Column change persisted via API | passed (Ph11) | 11-01 | [x] | **satisfied** |
| GUID-01 | Guide accessible from navigation | passed (Ph6) | 06-01 | [x] | **satisfied** |
| GUID-02 | Guide has editor configs | passed (Ph6) | 06-01 | [x] | **satisfied** |

**Orphaned requirements:** None. All 23 requirements appear in at least one phase VERIFICATION.md.

## Phase Verifications (6/6)

| Phase | Status | Score | Gaps |
|-------|--------|-------|------|
| 06 — Site Search + Guide | passed | 10/10 | None |
| 07 — MCP Search + Doc CRUD | passed | 10/10 | None |
| 08 — GitHub Auth | passed | 6/6 | None |
| 09 — GitHub API Wrapper | passed | 5/5 | None |
| 10 — Site Doc CRUD | passed | 4/4 | None |
| 11 — Interactive Kanban | human_needed | 5/5 | Human browser testing required for DnD |

All phases individually pass verification. Phase 11 awaits human browser testing for drag-and-drop visual feedback and persistence confirmation.

## Cross-Phase Integration (19/23 wired)

The integration checker found 4 gaps across phase boundaries:

### INT-01: Search index stale after CRUD (medium)

**Phase 10 → Phase 6:** `buildSearchIndex()` runs once on first focus. After doc create/edit/delete, `searchIndex` is never reset. New docs are absent from search, deleted docs remain searchable, edited content is stale — all until page refresh.

**Affected requirements:** SRCH-01–04, CRUD-01, CRUD-02, CRUD-04
**Fix:** Add `searchIndex = null;` after successful create, edit, and delete in `app.js`

### INT-02: Edit route accessible without auth (medium)

**Phase 8 → Phase 10:** Router dispatches `#/docs/:slug/edit` to `renderEditView()` without checking `getAuthToken()`. CSS hides edit buttons but direct URL navigation bypasses the gate. Save fails with error but the form is fully visible.

**Affected requirements:** AUTH-04, CRUD-02
**Fix:** Add auth guard in router before `renderEditView`

### INT-03: Script load order inverted (low)

**Phase 9 ↔ Phase 8:** `index.html` loads `app.js` before `github.js`, but `github.js` calls `getAuthToken()` from `app.js`. Works at runtime due to lazy invocation but is fragile.

**Fix:** Swap script order in `index.html`

### INT-04: mcp-guide excluded from MCP tools (low)

**Phase 6 → Phase 7:** `mcp-guide.md` not in `index.json`. Site search hardcodes it, but MCP tools validate against the index and cannot access it.

**Fix:** Add `mcp-guide` to `index.json` or special-case in MCP tools

## E2E Flow Verification (5/7)

| Flow | Status | Notes |
|------|--------|-------|
| Search: type → results → click → navigate | **Complete** | Works end-to-end within a session |
| Auth: enter PAT → verify → write controls appear | **Complete** | Full flow verified |
| Create doc: auth → New → form → save → sidebar | **Partial** | Creates correctly, but new doc absent from search until refresh (INT-01) |
| Edit doc: auth → edit → modify → save | **Partial** | Works but search content stale (INT-01); route accessible without auth (INT-02) |
| Delete doc: auth → delete → confirm → removed | **Complete** | Full flow including sidebar update |
| Kanban drag: auth → drag → confirm → persist | **Complete** | Pending human browser verification |
| MCP tools: search/add/edit/delete docs | **Complete** | All tools wired and functional |

## Tech Debt Summary

| Source | Count | Items |
|--------|-------|-------|
| Cross-phase integration | 4 | INT-01 through INT-04 (search staleness, edit route, script order, mcp-guide access) |
| Phase 11 | 1 | Verification status human_needed for DnD browser testing |
| Phase 10 | 1 | 10-02-SUMMARY.md missing `requirements-completed` frontmatter |

**Total: 6 items across 3 sources**

---

_Audited: 2026-02-22T14:00:00Z_
_Auditor: Claude (gsd audit-milestone)_
